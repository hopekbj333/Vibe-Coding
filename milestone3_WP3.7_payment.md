# 📦 WP 3.7: 결제 및 구독 시스템 (Payment & Subscription)

수익화를 위한 결제 시스템입니다.

---

## 💡 비개발자를 위한 전체 설명

**뭘 만드나요?**
앱에서 검사권을 구매하거나, 학습 콘텐츠를 구독할 수 있는 결제 시스템입니다.

**왜 필요한가요?**
- 서비스 운영을 위한 수익 필요
- 양질의 콘텐츠 지속 개발을 위한 자금
- 사용자에게 가치를 제공하고 대가를 받는 건전한 비즈니스 모델

**비즈니스 모델:**
- **검사권**: 기초 검사 1회에 X원 (일회성)
- **구독**: 월 Y원으로 학습 콘텐츠 무제한 (정기 결제)

---

## 💳 시나리오 1: 결제 연동

### S 3.7.1: 인앱 결제 연동

**📋 기술적 요구사항:**
- Google Play / App Store 인앱 결제 연동
- 결제 검증 서버 로직 구현

**💡 비개발자를 위한 설명:**

**어떻게 작동하나요?**
```
[결제 흐름]
1. 사용자가 상품 선택
2. 앱 → 스토어 결제 화면 호출
3. 사용자가 결제 완료
4. 스토어 → 앱으로 영수증 전달
5. 앱 → 서버로 영수증 검증 요청
6. 서버가 스토어에 영수증 확인
7. 검증 성공 → 상품 지급
```

**보안:**
- 클라이언트에서 직접 상품 지급 X
- 반드시 서버에서 영수증 검증 후 지급

---

### S 3.7.2: 결제 수단 관리

**📋 기술적 요구사항:**
- 등록된 결제 수단 조회/변경/삭제
- 결제 실패 시 재시도 로직

**💡 비개발자를 위한 설명:**

**화면 예시:**
```
[결제 수단 관리]

현재 결제 수단:
━━━━━━━━━━━━━━━━━━━━━━━━
💳 신용카드 ****-1234
   유효기간: 2026.12
   [삭제] [변경]
━━━━━━━━━━━━━━━━━━━━━━━━

[+ 새 결제 수단 추가]
```

**결제 실패 처리:**
```
결제 실패 시:
1. 1일 후 자동 재시도
2. 3일 후 2차 재시도
3. 7일 후 3차 재시도
4. 실패 시 구독 일시 중단 + 알림
```

---

## 📦 시나리오 2: 상품 구조

### S 3.7.3: 검사권 상품

**📋 기술적 요구사항:**
- 기초 검사 1회권, 5회권, 10회권

**💡 비개발자를 위한 설명:**

**상품 구성:**
```
[검사권 구매]

┌─────────────────────┐
│ 🎫 검사 1회권       │
│ ₩9,900             │
│                     │
│ [구매하기]          │
└─────────────────────┘

┌─────────────────────┐
│ 🎫 검사 5회권       │
│ ₩39,000  (20% 할인) │
│ 회당 ₩7,800        │
│ [구매하기]          │
└─────────────────────┘

┌─────────────────────┐
│ 🎫 검사 10회권  👑  │
│ ₩69,000  (30% 할인) │
│ 회당 ₩6,900        │
│ [구매하기]          │
└─────────────────────┘
```

---

### S 3.7.4: 학습 구독 상품

**📋 기술적 요구사항:**
- 월간/연간 구독 (학습 콘텐츠 무제한)
- 구독 시 검사권 일부 포함 혜택

**💡 비개발자를 위한 설명:**

**상품 구성:**
```
[학습 구독]

┌──────────────────────────┐
│ 📚 월간 구독              │
│ ₩19,900/월               │
│                          │
│ ✅ 모든 학습 게임 무제한  │
│ ✅ 월 1회 미니 테스트     │
│ ✅ 성장 리포트            │
│                          │
│ [구독하기]               │
└──────────────────────────┘

┌──────────────────────────┐
│ 📚 연간 구독  👑 BEST    │
│ ₩159,000/년 (33% 할인)   │
│ = ₩13,250/월             │
│                          │
│ ✅ 모든 학습 게임 무제한  │
│ ✅ 무제한 미니 테스트     │
│ ✅ 성장 리포트            │
│ 🎁 검사권 2회 포함       │
│                          │
│ [구독하기]               │
└──────────────────────────┘
```

---

### S 3.7.5: 무료 체험

**📋 기술적 요구사항:**
- 첫 검사 1회 무료 + 학습 3일 무료 체험
- 체험 종료 후 구독 유도 화면

**💡 비개발자를 위한 설명:**

**무료 체험 흐름:**
```
[가입 직후]
"환영해요! 🎉"
첫 검사 1회 무료
학습 콘텐츠 3일 무료 체험

[3일 후]
"체험이 종료되었어요 😊"
계속 학습하시려면 구독해주세요!
[구독하기] [나중에]
```

**유도 전략:**
- 체험 중 학습 데이터 축적
- "여기까지 성장했는데 멈추실 건가요?" 식의 메시지
- 체험 종료 시점에 할인 쿠폰 제공

---

## 📋 시나리오 3: 구독 관리

### S 3.7.6: 구독 상태 관리

**📋 기술적 요구사항:**
- 현재 구독 상태, 갱신일, 남은 검사권 표시
- 구독 해지/재개 기능

**💡 비개발자를 위한 설명:**

**화면 예시:**
```
[나의 구독]

현재 플랜: 📚 연간 구독
상태: ✅ 활성

━━━━━━━━━━━━━━━━━━━━━━━━
다음 갱신일: 2025.12.04
남은 검사권: 1회

[구독 변경] [해지하기]
━━━━━━━━━━━━━━━━━━━━━━━━
```

**해지 흐름:**
```
[해지하기 클릭]
     ↓
"정말 해지하시겠어요? 😢"
- 남은 기간: 5개월
- 학습 데이터는 유지됩니다
- 언제든 재구독 가능합니다

[취소] [해지 진행]
     ↓
[해지 사유 선택]
○ 가격이 부담됩니다
○ 아이가 사용하지 않습니다
○ 다른 서비스를 이용합니다
○ 기타: _______

[해지 완료]
```

---

### S 3.7.7: 영수증 및 내역

**📋 기술적 요구사항:**
- 결제 내역 조회
- 영수증 이메일 발송

**💡 비개발자를 위한 설명:**

**화면 예시:**
```
[결제 내역]

2025.12.04
연간 구독 갱신
₩159,000
[영수증 보기] [이메일 발송]

2025.11.04
검사권 5회권
₩39,000
[영수증 보기] [이메일 발송]

2025.10.15
첫 결제 - 연간 구독
₩159,000
[영수증 보기] [이메일 발송]
```

---

## 🛡️ 보안 및 정책

**보안 요구사항:**
- 결제 정보 암호화 저장
- PCI DSS 준수 (결제 대행사 이용)
- 영수증 검증 필수

**환불 정책:**
- 구독: 7일 이내 미사용 시 전액 환불
- 검사권: 미사용 건에 대해 환불 가능
- 스토어 정책 우선 적용

**법적 요구사항:**
- 미성년자 결제 시 법정대리인 동의
- 자동 결제 안내 의무
- 해지 절차 명확히 안내

---

## 🔧 기술 스택

| 영역 | 기술 |
|------|------|
| Android 결제 | Google Play Billing Library |
| iOS 결제 | StoreKit 2 |
| 서버 검증 | Firebase Functions |
| 결제 상태 | Firestore |
| 구독 관리 | RevenueCat (또는 직접 구현) |

---

**작성일**: 2025-12-04  
**상태**: 준비 완료

