# 📦 WP 1.3: 검사 실행 프레임워크 (Assessment Runner)

개별 문제가 얹혀질 '플레이어'를 만듭니다. 가장 핵심적인 공통 엔진입니다.

## 🎬 시나리오 1: 검사 초기화 및 인트로 (Initialization)

- [x] **S 1.3.1**: 검사 데이터 로딩 및 캐싱 ✅
    - 진입 시 해당 검사 세트의 이미지/오디오 리소스를 미리 로드(Pre-fetch)한다.
    - 로딩 중에는 '캐릭터가 준비 운동을 하는' 등의 지루하지 않은 애니메이션을 보여준다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
검사를 시작하기 전에 필요한 그림과 소리 파일을 미리 준비하는 시스템을 만들었습니다.

**구체적으로:**
- **데이터 로딩**: 검사에 사용될 문제 정보(질문, 보기, 정답)를 서버에서 가져옵니다.
- **로딩 애니메이션**: 데이터를 불러오는 동안 아이가 지루하지 않도록 귀여운 캐릭터가 움직이는 화면을 보여줍니다.
- **상태 관리**: "로딩 중", "로딩 완료", "오류 발생" 등 현재 상태를 추적합니다.

**왜 필요한가요?**
검사 중에 그림이나 소리를 불러오느라 버벅거리면 아이의 집중력이 흐트러집니다. 미리 준비해두면 검사가 매끄럽게 진행됩니다.

---

- [x] **S 1.3.2**: 인트로 가이드 재생 ✅
    - 로딩 완료 후, 성우 음성으로 "안녕? 지금부터 재미있는 놀이를 할 거야."라는 오프닝 멘트를 재생한다.
    - 음성이 나오는 동안에는 화면 터치를 막아(Block Input) 아이가 설명을 끝까지 듣도록 유도한다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
검사 시작 전에 친근한 캐릭터가 아이에게 인사하고 안내하는 인트로 화면을 만들었습니다.

**구체적으로:**
- **캐릭터 애니메이션**: 말하는 것처럼 둠칫둠칫 움직이는 캐릭터를 보여줍니다.
- **입력 차단**: 인트로가 나오는 동안에는 화면을 터치해도 반응하지 않습니다. 이렇게 하면 아이가 설명을 끝까지 듣게 됩니다.
- **자막 표시**: 음성으로 나오는 내용을 화면에도 함께 표시합니다 (부모/교사 확인용).

**왜 필요한가요?**
아이들은 호기심이 많아서 화면이 나타나자마자 마구 터치하려 합니다. 중요한 설명을 들을 때는 잠시 터치를 막아서, 아이가 "무엇을 해야 하는지" 이해한 후에 시작하도록 합니다.

**비유로 설명하면:**
학교에서 선생님이 문제를 설명할 때 "자, 선생님 말 끝날 때까지 기다려~"라고 하는 것과 같습니다. 설명이 끝나면 "이제 시작!"이라고 알려줍니다.

---

## 🔄 시나리오 2: 문항 재생 루프 (Question Cycle)

- [x] **S 1.3.3**: 문항 제시 (Presentation) ✅
    - 화면에 문제 이미지(선택지 등)를 천천히 페이드인(Fade-in)한다.
    - 시각 요소 등장 0.5초 후, 문제 지시문 오디오("다음 중 사과를 찾아봐")를 재생한다.
    - 오디오 재생 중에는 정답 선택을 할 수 없도록 입력 잠금 상태를 유지한다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
문제를 보여주는 방식을 아이 친화적으로 설계했습니다.

**구체적으로:**
- **천천히 나타나기 (Fade-in)**: 문제가 갑자기 "팍!" 하고 나타나지 않고, 0.5초에 걸쳐 서서히 나타납니다.
- **소리 안내**: 그림이 나타나고 0.5초 후에 "다음 중 사과를 찾아봐"와 같은 음성 안내가 나옵니다.
- **입력 차단 유지**: 음성이 나오는 동안에는 여전히 터치할 수 없습니다. 문제를 끝까지 듣고 나서 선택하도록 합니다.

**왜 필요한가요?**
아이들은 그림이 보이면 바로 터치하려고 합니다. 하지만 음성 설명을 먼저 들어야 문제를 이해할 수 있습니다. 이 순서를 지키면 아이가 "무엇을 해야 하는지" 확실히 알고 답을 선택할 수 있습니다.

**비유로 설명하면:**
선생님이 칠판에 그림을 붙이고, "자, 이 중에서 사과를 찾아볼까?"라고 말한 다음에 손을 들라고 하는 것과 같습니다.

---

- [x] **S 1.3.4**: 사용자 입력 대기 및 처리 (Input Handling) ✅
    - 오디오가 끝나면 '띵' 하는 효과음과 함께 입력 잠금을 해제한다.
    - 사용자가 화면을 터치하거나 마이크에 대고 말할 때, 시각적 피드백(버튼 눌림 효과, 파형 표시)을 즉시 보여준다.
    - 입력된 데이터(선택한 인덱스, 녹음 파일 경로, 반응 시간)를 임시 버퍼에 저장한다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
음성 설명이 끝난 후 아이가 답을 선택할 수 있게 하고, 선택했을 때 "잘 눌렸다"는 느낌을 주는 시스템을 만들었습니다.

**구체적으로:**
- **입력 해제 알림**: 음성이 끝나면 "이제 선택해 봐!"라는 표시와 함께 초록색 점이 나타납니다.
- **터치 피드백**: 보기를 터치하면 버튼이 살짝 작아지고 테두리가 파란색으로 바뀝니다. 이렇게 하면 아이가 "내가 눌렀다"는 것을 확실히 알 수 있습니다.
- **반응 시간 측정**: 음성이 끝난 시점부터 아이가 답을 선택할 때까지의 시간을 기록합니다. 이 정보는 나중에 아이의 인지 속도를 분석하는 데 사용됩니다.
- **정오답 피드백**: 선택 후 큰 O(정답) 또는 X(오답) 표시가 화면에 나타나 아이에게 결과를 알려줍니다.
- **답변 저장**: 아이가 무엇을 선택했는지, 얼마나 빨리 선택했는지 등의 정보를 저장해둡니다.

**왜 필요한가요?**
아이가 화면을 터치했을 때 아무런 반응이 없으면 "눌린 건가?"하고 혼란스러워합니다. 즉각적인 시각 피드백은 아이에게 확신을 주고, 검사를 더 재미있게 느끼게 합니다. 또한 반응 시간 데이터는 단순히 정답/오답보다 더 풍부한 정보를 제공합니다.

**비유로 설명하면:**
게임에서 버튼을 누르면 "틱!" 소리가 나면서 버튼이 눌리는 것처럼 보이는 것과 같습니다. 이런 작은 반응들이 아이에게 "잘하고 있어!"라는 느낌을 줍니다.

---

- [x] **S 1.3.5**: 화면 전환 (Transition) ✅
    - 입력 완료 후, 즉시 다음 문제로 넘어가지 않고 1초 정도의 딜레이(Think Time)를 둔다.
    - 다음 문제로 넘어갈 때 부드러운 전환 애니메이션을 사용한다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
한 문제에서 다음 문제로 넘어갈 때, 갑자기 바뀌지 않고 자연스럽게 전환되도록 만들었습니다.

**구체적으로:**
- **1초 대기 시간 (Think Time)**: 아이가 답을 선택하면 바로 다음 문제로 넘어가지 않고, 1초 동안 기다립니다. 이 시간 동안 아이는 "방금 내가 뭘 눌렀지?"를 생각하고 다음 문제를 준비할 수 있습니다.
- **부드러운 페이드 전환**: 현재 문제가 서서히 사라지고(Fade out), 다음 문제가 서서히 나타납니다(Fade in). 갑작스러운 화면 전환은 아이를 놀라게 할 수 있기 때문입니다.
- **전환 중 입력 차단**: 전환 중에는 화면을 터치해도 반응하지 않습니다. 실수로 다음 문제의 답을 눌러버리는 것을 방지합니다.

**왜 필요한가요?**
어린 아이들은 화면이 갑자기 바뀌면 당황할 수 있습니다. 부드러운 전환은 아이에게 "지금 다음 문제로 넘어가는 중이야"라는 시각적 신호를 주어, 검사 흐름을 자연스럽게 따라갈 수 있게 합니다.

**비유로 설명하면:**
책을 읽을 때 페이지를 넘기는 것과 같습니다. 갑자기 다음 페이지가 나타나는 게 아니라, 페이지가 넘어가는 동안 잠시 기다리게 되죠. 이런 자연스러운 흐름이 아이의 집중력을 유지시킵니다.

---

## 🎓 시나리오 3: 튜토리얼 모드 (Tutorial Logic)

- [x] **S 1.3.6**: 연습 문제 수행 및 정오답 피드백 ✅
    - 연습 문제에서는 정답/오답 여부를 즉시 O/X 애니메이션과 음성으로 알려준다.
    - 오답일 경우, "다시 한번 잘 들어봐"라는 음성과 함께 문제를 다시 들려준다 (Re-try 로직).

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
연습 문제에서 아이가 답을 선택하면 바로 "정답이야!" 또는 "다시 해보자!"라고 알려주는 기능을 만들었습니다. 틀리면 같은 문제를 다시 풀 수 있습니다.

**구체적으로:**
- **정답 피드백**: 정답을 선택하면 큰 초록색 O 마크가 화면에 나타나고, "잘했어! 정답이야!"라는 음성이 재생됩니다.
- **오답 피드백**: 틀리면 빨간색 X 마크가 나타나고, "아쉽다! 다시 한번 잘 들어봐."라는 음성과 함께 같은 문제를 다시 풀 수 있습니다.
- **재시도 제한**: 같은 문제를 최대 3번까지 시도할 수 있습니다. 3번 모두 틀리면 "괜찮아! 다음 문제로 넘어가자."라고 격려하며 다음 문제로 넘어갑니다.
- **시도 횟수 표시**: 화면에 "(1번째 시도)", "(2번째 시도)" 등으로 현재 몇 번째 시도인지 보여줍니다.
- **연습 모드 표시**: 화면 상단에 "🎓 연습 모드"라는 뱃지가 표시되어, 아이가 지금 연습 중이라는 것을 알 수 있습니다.

**왜 필요한가요?**
연습 문제의 목적은 아이가 검사 방식에 익숙해지는 것입니다. 바로 피드백을 주면 아이가 "어떻게 하는 건지" 이해하고, 본 검사에서 더 잘 할 수 있습니다. 또한 틀려도 다시 시도할 수 있다는 것을 알면 아이가 덜 긴장합니다.

**본 검사와의 차이:**
| 항목 | 연습 모드 | 본 검사 모드 |
|------|----------|------------|
| 정오답 피드백 | O (바로 알려줌) | X (알려주지 않음) |
| 재시도 | O (최대 3회) | X (한 번만) |
| 격려 음성 | O | X |

**비유로 설명하면:**
운전면허 시험 전에 연습 문제를 푸는 것과 같습니다. 연습할 때는 틀리면 정답을 알려주고 다시 풀 수 있지만, 실제 시험에서는 바로 다음 문제로 넘어가죠.

---

- [x] **S 1.3.7**: 본 검사 진입 트리거 ✅
    - 연습 문제를 2회 이상 맞히거나, 최대 시도 횟수를 초과하면 "이제 진짜 시작해볼까?"라는 멘트와 함께 본 검사로 넘어간다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
연습 모드를 충분히 잘 수행한 아이에게 "이제 진짜 검사를 시작해볼까?"라고 제안하는 기능을 만들었습니다.

**구체적으로:**
- **모드 선택 화면**: 검사 시작 전에 "🎓 연습부터 할래!" 또는 "🚀 바로 시작할래!" 중에서 선택할 수 있습니다.
- **진입 조건**: 연습 문제에서 **2개 이상 정답**을 맞히면, 완료 화면에서 "🚀 진짜 검사 시작!" 버튼이 나타납니다.
- **조건 미달 시**: 2개 미만으로 맞히면 "🎓 다시 연습하기" 버튼이 나타나서, 더 연습할 수 있습니다.
- **음성 안내**: 조건을 충족하면 "연습 끝! 이제 진짜 시작해볼까?"라고 말해줍니다.

**왜 필요한가요?**
연습의 목적은 아이가 검사 방식을 이해하는 것입니다. 연습에서 충분히 잘하면 본 검사를 시작해도 되지만, 아직 방식을 이해하지 못했다면 더 연습하는 것이 좋습니다. 이 기능은 아이의 준비 상태에 따라 적절한 다음 단계를 안내합니다.

**비유로 설명하면:**
수영을 배울 때 물에 들어가기 전에 발차기 연습을 하는 것과 같습니다. 발차기를 잘하면 "이제 물에 들어가볼까?"라고 하고, 아직 어려우면 "조금 더 연습해보자"라고 하는 것이죠.

---

## ⏸️ 시나리오 4: 중단 및 이어하기 (Pause & Resume)

- [x] **S 1.3.8**: 일시 정지 및 이탈 처리 ✅
    - 우측 상단 '나가기' 버튼을 길게 누르면(오터치 방지) 일시 정지 메뉴를 띄운다.
    - 앱을 강제 종료하거나 이탈할 경우, 현재 진행 중인 문항 번호와 답안 데이터를 로컬 DB(Hive/SharedPrefs)에 자동 저장한다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
검사 중에 앱을 나가거나 강제 종료해도, 진행 상황이 자동으로 저장되어 나중에 이어서 할 수 있게 만들었습니다.

**구체적으로:**
- **자동 저장**: 아이가 답을 선택할 때마다, 현재 진행 상황(몇 번째 문제까지 했는지, 어떤 답을 선택했는지)이 자동으로 기기에 저장됩니다.
- **나가기 버튼**: 화면 우측 상단의 X 버튼을 **길게 누르면** 나가기 확인 팝업이 나타납니다. 짧게 누르면 반응하지 않아서, 아이가 실수로 나가는 것을 방지합니다.
- **24시간 유효**: 저장된 진행 상황은 24시간 동안만 유효합니다. 그 이후에는 자동으로 삭제되어 처음부터 다시 시작합니다.

**왜 필요한가요?**
어린 아이들은 검사 중에 갑자기 화장실에 가거나, 실수로 앱을 닫을 수 있습니다. 이런 상황에서 처음부터 다시 시작해야 한다면 아이가 지칠 수 있습니다. 자동 저장 기능이 있으면 언제든 중단했다가 이어서 할 수 있습니다.

**비유로 설명하면:**
책을 읽다가 책갈피를 꽂아두는 것과 같습니다. 나중에 다시 읽을 때 책갈피가 있는 페이지부터 계속 읽을 수 있죠.

---

- [x] **S 1.3.9**: 이어하기 로직 ✅
    - 중단된 검사에 재진입 시, "지난번 하던 곳부터 계속할까?" 팝업을 띄운다.
    - 저장된 문항 번호의 **직전 문항**부터 시작하거나, 인트로를 짧게 다시 보여주어 맥락을 상기시킨다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
이전에 중단한 검사가 있으면, 다시 시작할 때 "이어서 할까?"라고 물어보는 기능을 만들었습니다.

**구체적으로:**
- **이어하기 팝업**: 저장된 진행 상황이 있으면, 검사 시작 화면에서 자동으로 팝업이 나타납니다.
- **선택 옵션**: "이어서 할래!" 또는 "처음부터 할래" 중에서 선택할 수 있습니다.
- **진행 정보 표시**: 팝업에서 "연습 모드/검사 모드", "몇 번 문제까지 했는지" 정보를 보여줍니다.

**왜 필요한가요?**
아이가 어제 3번 문제까지 했다면, 오늘 다시 1번부터 하는 것보다 3번부터 이어서 하는 게 효율적입니다. 하지만 아이가 원하면 처음부터 다시 시작할 수도 있어야 합니다.

---

## 💾 시나리오 5: 검사 완료 및 데이터 전송 (Completion)

- [x] **S 1.3.10**: 검사 종료 시퀀스 ✅
    - 마지막 문제까지 완료하면 폭죽 애니메이션 등 큰 보상을 시각적으로 제공한다.
    - 로컬에 저장된 모든 답안 데이터를 서버(Firestore/Storage)로 일괄 전송한다.
    - 전송 실패 시(오프라인 등), '전송 대기' 상태로 로컬에 저장하고 네트워크 연결 시 재시도한다.

**💡 비개발자를 위한 설명:**

**뭘 했나요?**
검사가 끝나면 아이에게 큰 보상(폭죽 애니메이션)을 보여주고, 검사 결과를 서버에 안전하게 저장하는 기능을 만들었습니다.

**구체적으로:**
1. **폭죽 애니메이션**: 마지막 문제를 풀면 화면에 큰 축하 애니메이션이 나타납니다.
   - 커지면서 나타나는 동그라미
   - 주변에 반짝이는 별들
   - 밝은 색상의 폭죽 아이콘
   
2. **결과 저장**: 검사 결과(어떤 답을 선택했는지, 얼마나 빨리 답했는지 등)를 서버에 저장합니다.
   - 저장 성공: "결과가 저장되었어요!" 메시지
   - 인터넷 없음: "인터넷 연결 시 자동 저장돼요" 메시지 (나중에 자동 재시도)
   
3. **오프라인 지원**: 인터넷이 안 되는 곳에서 검사를 해도 결과가 기기에 저장되어 있다가, 나중에 인터넷이 연결되면 자동으로 서버에 전송됩니다.

**왜 필요한가요?**
- **보상 애니메이션**: 아이들에게 "잘했다!"는 느낌을 시각적으로 크게 전달해서 성취감을 느끼게 합니다.
- **안전한 저장**: 검사 결과가 유실되지 않도록 서버에 저장하고, 오프라인에서도 안심하고 검사할 수 있습니다.
- **데이터 분석**: 저장된 결과로 아이의 발달 상태를 분석하고 리포트를 생성할 수 있습니다.

**비유로 설명하면:**
운동회에서 달리기를 끝내면 메달을 주고, 기록을 기록부에 적어두는 것과 같습니다. 메달은 아이에게 기쁨을 주고, 기록은 나중에 성장을 확인하는 데 사용됩니다.

---

