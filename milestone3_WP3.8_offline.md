# 📦 WP 3.8: 오프라인 지원 및 최적화 (Offline & Optimization)

네트워크 없이도 학습 가능하도록 최적화합니다.

---

## 💡 비개발자를 위한 전체 설명

**뭘 만드나요?**
인터넷 없이도 앱을 사용할 수 있게 하고, 앱이 빠르고 안정적으로 동작하도록 개선합니다.

**왜 필요한가요?**
- 이동 중 (지하철, 차 안)에도 학습
- 느린 인터넷 환경에서도 문제없이 사용
- 배터리 오래 가게 최적화
- 아이 정보 안전하게 보호

**실생활 상황:**
- 비행기 모드에서도 학습
- 시골 할머니 집에서도 학습
- 데이터 끊겨도 진행 중이던 게임 계속

---

## 📴 시나리오 1: 오프라인 모드

### S 3.8.1: 스마트 캐싱

**📋 기술적 요구사항:**
- 자주 사용하는 학습 콘텐츠 자동 다운로드
- Wi-Fi 연결 시에만 대용량 에셋 다운로드

**💡 비개발자를 위한 설명:**

**어떻게 작동하나요?**
```
[Wi-Fi 연결됨]
🔄 백그라운드 다운로드 중...
   - 음절 게임 에셋 (15MB) ✅
   - 리듬 게임 음원 (8MB) ✅
   - 오늘 추천 콘텐츠 (5MB) ✅

[다운로드 완료]
📱 오프라인에서도 학습 가능!
```

**스마트 다운로드 규칙:**
- 최근 많이 사용한 게임 우선
- 다음 추천 콘텐츠 미리 다운로드
- Wi-Fi에서만 대용량 파일 다운로드
- 저장 공간 부족 시 오래된 캐시 자동 삭제

---

### S 3.8.2: 오프라인 학습 지원

**📋 기술적 요구사항:**
- 네트워크 없이 캐싱된 콘텐츠로 학습 진행
- 학습 데이터는 로컬 저장 후 온라인 시 동기화

**💡 비개발자를 위한 설명:**

**어떻게 작동하나요?**
```
[오프라인 상태]
📵 인터넷 연결 없음

[학습 시작]
✅ 캐싱된 콘텐츠로 학습 가능!
   - 음절 쪼개기 ✅
   - 리듬 따라하기 ✅
   - 숫자 기억 ✅

[학습 완료]
💾 결과가 기기에 저장되었어요
   온라인 시 자동으로 동기화됩니다
```

**오프라인 불가 기능:**
- 첫 검사 (서버 채점 필요)
- 새 계정 생성
- 리포트 공유

---

### S 3.8.3: 동기화 관리

**📋 기술적 요구사항:**
- 오프라인 중 쌓인 데이터 자동 동기화
- 충돌 발생 시 서버 데이터 우선 또는 사용자 선택

**💡 비개발자를 위한 설명:**

**어떻게 작동하나요?**
```
[온라인 복귀]
🔄 동기화 중...
   - 학습 기록 5건 업로드 ✅
   - 배지 획득 정보 동기화 ✅
   - 완료!

[충돌 발생 시]
⚠️ 데이터 충돌 감지
다른 기기에서 변경된 내용이 있어요.

[최신 데이터 유지] - 서버 데이터 사용
[내 데이터 유지] - 이 기기 데이터 사용
```

---

## ⚡ 시나리오 2: 성능 최적화

### S 3.8.4: 앱 시작 속도 최적화

**📋 기술적 요구사항:**
- 스플래시 화면 중 필수 데이터만 로딩
- 지연 로딩으로 초기 로딩 시간 단축

**💡 비개발자를 위한 설명:**

**개선 전:**
```
앱 시작 → 모든 데이터 로딩 (5초) → 홈 화면
```

**개선 후:**
```
앱 시작 → 필수 데이터만 로딩 (1초) → 홈 화면
       → 백그라운드에서 나머지 로딩
```

**지연 로딩 대상:**
- 프로필 이미지: 화면에 보일 때 로딩
- 학습 기록: 해당 탭 진입 시 로딩
- 게임 에셋: 게임 시작 시 로딩

---

### S 3.8.5: 메모리 관리

**📋 기술적 요구사항:**
- 사용하지 않는 에셋 자동 해제
- 저사양 기기 대응 (이미지 품질 자동 조절)

**💡 비개발자를 위한 설명:**

**메모리 관리:**
```
[게임 중]
🎮 현재 게임 에셋 사용 중

[다른 화면 이동]
🗑️ 이전 게임 에셋 해제
📦 새 화면 에셋 로딩
```

**저사양 기기 대응:**
```
[기기 사양 감지]
RAM 2GB 이하 → 저품질 이미지 사용
RAM 4GB 이상 → 고품질 이미지 사용

[저사양 모드]
- 이미지 해상도 50% 축소
- 애니메이션 간소화
- 동시 로딩 수 제한
```

---

### S 3.8.6: 배터리 최적화

**📋 기술적 요구사항:**
- 백그라운드 동작 최소화
- 게임 루프 최적화로 배터리 소모 절감

**💡 비개발자를 위한 설명:**

**최적화 항목:**
```
[백그라운드 최소화]
- 앱 백그라운드 시 게임 루프 정지
- 불필요한 위치 추적 X
- 알림만 필요할 때 체크

[게임 루프 최적화]
- 정지 화면에서 FPS 낮춤 (60 → 30)
- 화면 꺼짐 시 렌더링 중단
- 불필요한 재계산 방지
```

---

## 🔒 시나리오 3: 데이터 보안 강화

### S 3.8.7: 로컬 데이터 암호화

**📋 기술적 요구사항:**
- 민감 데이터(아동 정보, 검사 결과) 암호화 저장
- 앱 삭제 시 데이터 완전 삭제

**💡 비개발자를 위한 설명:**

**암호화 대상:**
```
[암호화 저장]
🔐 아동 이름, 생년월일
🔐 검사 결과 데이터
🔐 학습 기록
🔐 결제 정보 (토큰만 저장)

[암호화 안 함]
📁 게임 에셋 (이미지, 음원)
📁 앱 설정 (볼륨, 알림 등)
```

**데이터 삭제:**
```
[앱 삭제 시]
🗑️ 모든 로컬 데이터 완전 삭제
   - 암호화 키 폐기
   - 캐시 파일 삭제
   - 복구 불가능

[계정 탈퇴 시]
🗑️ 서버 데이터도 함께 삭제
   - 30일 유예 기간 후 영구 삭제
```

---

### S 3.8.8: 개인정보 관리

**📋 기술적 요구사항:**
- 데이터 내보내기/삭제 요청 기능
- GDPR/개인정보보호법 준수

**💡 비개발자를 위한 설명:**

**화면 예시:**
```
[개인정보 관리]

📥 내 데이터 내보내기
   모든 학습 기록과 검사 결과를
   JSON 파일로 다운로드합니다.
   [내보내기]

🗑️ 데이터 삭제 요청
   모든 개인정보와 학습 기록을
   영구적으로 삭제합니다.
   [삭제 요청]

ℹ️ 개인정보 처리방침
   [전문 보기]
```

**법적 준수:**
- 수집 정보 명시
- 이용 목적 명시
- 제3자 제공 동의
- 삭제 요청권 보장

---

## 🔧 기술 스택

| 영역 | 기술 |
|------|------|
| 로컬 저장 | Hive / SQLite |
| 캐싱 | flutter_cache_manager |
| 암호화 | flutter_secure_storage |
| 동기화 | Firestore offline persistence |
| 성능 측정 | Firebase Performance |

---

## 📊 성능 목표

| 지표 | 목표 |
|------|------|
| 앱 시작 시간 | < 2초 |
| 화면 전환 | < 300ms |
| 메모리 사용 | < 150MB |
| 오프라인 학습 | 최소 5개 게임 |
| 배터리 소모 | 시간당 < 5% |

---

**작성일**: 2025-12-04  
**상태**: 준비 완료

